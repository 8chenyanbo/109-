<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>管理員介面</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <div class="card">
    <h2>管理員介面</h2>

    <!-- 成績表格 -->
    <table id="grades-table">
      <thead>
        <tr>
          <th>座號</th>
          <th>科目</th>
          <th>分數</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- 新增科目區塊（只有管理員可見） -->
    <div id="add-subject-section" style="margin-top:16px;">
      <h3>新增科目</h3>
      <input type="text" id="new-subject" placeholder="科目名稱" />
      <button onclick="addSubject()">新增科目</button>
    </div>

    <!-- 指定編輯者區塊（只有管理員可見） -->
    <div id="assign-editor-section" style="margin-top:16px;">
      <h3>指定編輯者</h3>
      <input type="text" id="editor-seat" placeholder="座號" />
      <button onclick="assignEditor()">指定編輯者</button>
    </div>
  </div>

  <script src="assets/script.js"></script>
  <script>
    const seat = localStorage.getItem("seat");
    let editors = JSON.parse(localStorage.getItem("editors") || "[]");
    const isAdmin = (seat === "114129");
    const isEditor = editors.includes(seat);

    // 顯示角色提示
    const roleBox = document.createElement("div");
    roleBox.style.position = "fixed";
    roleBox.style.bottom = "16px";
    roleBox.style.right = "16px";
    roleBox.style.background = "#FB7185";
    roleBox.style.color = "white";
    roleBox.style.padding = "6px 10px";
    roleBox.style.borderRadius = "6px";
    roleBox.textContent = isAdmin ? "目前權限：管理員" : 
                          (isEditor ? "目前權限：編輯者" : "目前權限：查詢者");
    document.body.appendChild(roleBox);

    // 控制介面顯示
    if (!isAdmin) {
      document.getElementById("add-subject-section").style.display = "none";
      document.getElementById("assign-editor-section").style.display = "none";
    }

    // 載入成績
    let grades = JSON.parse(localStorage.getItem("grades") || "{}");
    const tbody = document.querySelector("#grades-table tbody");
    for (let sid in grades) {
      for (let subject in grades[sid]) {
        const score = grades[sid][subject];
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${sid}</td>
          <td>${subject}</td>
          <td><input type="number" value="${score}" ${(!isAdmin && !isEditor) ? "disabled" : ""}></td>
          <td><button class="edit-btn" onclick="editGrade('${sid}','${subject}', this.parentElement.parentElement.querySelector('input').value)">更新</button></td>
        `;
        tbody.appendChild(row);
      }
    }

    // 編輯成績
    function editGrade(seatId, subject, newScore) {
      if (!isAdmin && !isEditor) {
        alert("您沒有編輯成績的權限！");
        return;
      }
      grades[seatId][subject] = parseInt(newScore);
      localStorage.setItem("grades", JSON.stringify(grades));
      alert("成績已更新！");
    }

    // 新增科目（只有管理員能用）
    function addSubject() {
      if (!isAdmin) {
        alert("您沒有新增科目的權限！");
        return;
      }
      const subjectName = document.getElementById("new-subject").value.trim();
      if (!subjectName) return;
      for (let sid in grades) {
        grades[sid][subjectName] = 0;
      }
      localStorage.setItem("grades", JSON.stringify(grades));
      alert("科目已新增！");
      location.reload();
    }

    // 指定編輯者（只有管理員能用）
    function assignEditor() {
      if (!isAdmin) {
        alert("您沒有指定編輯者的權限！");
        return;
      }
      const editorSeat = document.getElementById("editor-seat").value.trim();
      if (editorSeat && !editors.includes(editorSeat)) {
        editors.push(editorSeat);
        localStorage.setItem("editors", JSON.stringify(editors));
        alert("已指定座號 " + editorSeat + " 為編輯者！");
      }
    }
  </script>
</body>
</html>
